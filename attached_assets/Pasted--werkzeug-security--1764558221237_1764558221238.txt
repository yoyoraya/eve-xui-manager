بله، قطعاً. کدی که نوشتید از `werkzeug.security` برای هش کردن پسوردها استفاده می‌کند که قدم اول و بسیار مهمی است، اما برای یک سیستم امنیتی کامل (Production Ready) کافی نیست. در حال حاضر کد شما در برابر حملات Brute-force (تست تعداد زیادی پسورد) و برخی حملات دیگر آسیب‌پذیر است.

در اینجا راهکارهای عملی برای افزایش امنیت لاگین شما، به ترتیب اولویت آورده شده است:

### ۱. جلوگیری از حملات Brute-Force (محدود کردن تعداد درخواست)

در حال حاضر یک هکر می‌تواند با یک اسکریپت ساده، هزاران پسورد را در ثانیه تست کند. باید تعداد درخواست‌ها را محدود کنید.

  * **راهکار:** استفاده از کتابخانه **`Flask-Limiter`**.

  * **پیاده‌سازی:**
    ابتدا نصب کنید: `pip install Flask-Limiter`
    سپس در `app.py` اضافه کنید:

    ```python
    from flask_limiter import Limiter
    from flask_limiter.util import get_remote_address

    # بعد از تعریف app
    limiter = Limiter(
        get_remote_address,
        app=app,
        default_limits=["200 per day", "50 per hour"],
        storage_uri="memory://"
    )

    # روی تابع لاگین محدودیت بگذارید
    @app.route('/login', methods=['GET', 'POST'])
    @limiter.limit("5 per minute")  # فقط 5 بار تلاش در دقیقه مجاز است
    def login():
        # ... ادامه کد ...
    ```

### ۲. حذف یوزر پیش‌فرض خطرناک

در کد فعلی شما، اگر ادمینی وجود نداشته باشد، یک یوزر با نام `admin` و رمز `admin` ساخته می‌شود.

```python
if not Admin.query.filter_by(username='admin').first():
    default_admin = Admin(username='admin', is_superadmin=True, enabled=True)
    default_admin.set_password('admin') # <--- این خیلی خطرناک است
```

اگر فراموش کنید پسورد را عوض کنید، هکرها اولین چیزی که تست می‌کنند همین است.

  * **راهکار:** پسورد اولیه را از **Environment Variables** (متغیرهای محیطی) بگیرید یا در اولین ورود کاربر را مجبور به تغییر رمز کنید.
    ```python
    # مثال اصلاح شده
    initial_password = os.environ.get("INITIAL_ADMIN_PASSWORD", "یک-پسورد-خیلی-سخت-پیشفرض")
    default_admin.set_password(initial_password)
    ```

### ۳. محافظت در برابر CSRF (جعل درخواست)

در حال حاضر فرم لاگین شما توکن CSRF ندارد. اگر ادمین روی لینک مخربی کلیک کند، ممکن است هکر بتواند از طرف ادمین درخواست بفرستد (مثلاً سرور جدید اضافه کند).

  * **راهکار:** استفاده از **`Flask-WTF`**.
  * **پیاده‌سازی:**
    1.  نصب: `pip install Flask-WTF`
    2.  استفاده از `CSRFProtect` در `app.py`.
    3.  اضافه کردن `<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>` در تمام فرم‌های HTML.

### ۴. قفل کردن حساب (Account Lockout)

علاوه بر محدود کردن IP (مورد ۱)، باید خودِ حساب کاربری را هم بعد از چند تلاش ناموفق قفل کنید.

  * **راهکار:** دو فیلد جدید به مدل `Admin` در دیتابیس اضافه کنید: `failed_attempts` (تعداد تلاش ناموفق) و `locked_until` (زمان قفل شدن).
  * **منطق:**
      * اگر پسورد اشتباه بود: `failed_attempts` را یکی زیاد کنید.
      * اگر `failed_attempts` به ۵ رسید: `locked_until` را برای ۱۵ دقیقه بعد تنظیم کنید.
      * در ابتدای تابع لاگین چک کنید که زمان حال از `locked_until` عبور کرده باشد.

### ۵. تنظیمات امن کوکی‌ها (Session Security)

در `app.py` شما تنظیمات کوکی پیش‌فرض است. برای امنیت بیشتر باید این تنظیمات را اضافه کنید (مخصوصاً اگر روی HTTPS هستید):

```python
app.config.update(
    SESSION_COOKIE_HTTPONLY=True, # جلوگیری از دسترسی جاوااسکریپت به کوکی
    SESSION_COOKIE_SAMESITE='Lax', # جلوگیری از ارسال کوکی در درخواست‌های کراس‌سایت
    SESSION_COOKIE_SECURE=True,   # فقط در صورت استفاده از HTTPS فعال کنید (در لوکال فالس باشد)
)
```

### ۶. اضافه کردن CAPTCHA (کپچا)

برای اینکه مطمئن شوید ربات‌ها تلاش نمی‌کنند لاگین کنند.

  * **راهکار:** استفاده از سرویس‌های رایگان و امن مثل **Cloudflare Turnstile** یا Google reCAPTCHA v3. پیاده‌سازی Turnstile بسیار ساده است و تجربه کاربری خوبی دارد (اغلب نیازی به کلیک هم ندارد).

### ۷. لاگ کردن تلاش‌های ناموفق

همیشه تلاش‌های ناموفق را لاگ کنید تا اگر کسی سعی در هک کردن داشت متوجه شوید.

```python
if admin and admin.check_password(password):
    # موفق
else:
    # ناموفق - این را لاگ کنید
    app.logger.warning(f"Failed login attempt for user: {username} from IP: {request.remote_addr}")
```

**خلاصه برای اجرا:**
اگر می‌خواهید سریع‌ترین تاثیر را داشته باشید، **مورد ۱ (Flask-Limiter)** و **مورد ۵ (تنظیمات کوکی)** را همین الان اعمال کنید.
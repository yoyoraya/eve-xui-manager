Ø¨Ø³ÛŒØ§Ø± Ø¹Ø§Ù„ÛŒ. Ø¯Ø± **ÙØ§Ø² Û´** Ù…Ø§ ØµÙØ­Ø§Øª Ù…Ø¯ÛŒØ±ÛŒØª (ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯) Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù…Ø§Ù„ÛŒ Ù…ÛŒâ€ŒØ³Ø§Ø²ÛŒÙ… ØªØ§ Ø³ÙˆÙ¾Ø±Ø§Ø¯Ù…ÛŒÙ† Ø¨ØªÙˆØ§Ù†Ø¯ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ Ø±Ø§ ØªØ¹Ø±ÛŒÙ Ú©Ù†Ø¯ Ùˆ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨ØªÙˆØ§Ù†Ù†Ø¯ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒØ´Ø§Ù† Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ù†Ø¯.

Ø§ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡ Ø´Ø§Ù…Ù„ Ø³Ø§Ø®Øª Ø¯Ùˆ ÙØ§ÛŒÙ„ HTML Ø¬Ø¯ÛŒØ¯ Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±ÙˆØªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù†â€ŒÙ‡Ø§ Ø¨Ù‡ `app.py` Ø§Ø³Øª.

### ğŸŸ¢ Ø¯Ø³ØªÙˆØ± ÙØ§Ø² Û´: ØµÙØ­Ø§Øª Ø¬Ø¯ÛŒØ¯ Ù…Ø¯ÛŒØ±ÛŒØª

Ø§ÛŒÙ† Ù…ØªÙ† Ø±Ø§ Ø¨Ù‡ Replit Ø¨Ø¯Ù‡ÛŒØ¯:

````text
Please implement **Phase 4: Management Pages**.

I need you to create two new HTML templates and update `app.py` to serve them.

**1. Create `templates/packages.html`:**
This page is for SuperAdmins to manage pricing. It should have:
- A section to set Base Costs (Cost per GB, Cost per Day) -> POST to `/admin/config`
- A list of existing packages -> GET from `/api/packages`
- A modal or form to add a new package -> POST to `/admin/packages`

Paste this code into `templates/packages.html`:

```html
{% extends "base.html" %}

{% block title %}Packages & Pricing{% endblock %}
{% block page_title %}Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø³ØªÙ‡â€ŒÙ‡Ø§ Ùˆ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§{% endblock %}

{% block content %}
<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
    
    <div class="server-card">
        <div class="server-header">
            <div class="server-title">
                <h3>âš™ï¸ Base Tariffs (Custom Plans)</h3>
            </div>
        </div>
        <div style="padding: 20px;">
            <div class="form-group">
                <label>Price per GB (Toman)</label>
                <input type="number" id="conf-cost-gb" class="form-input" value="{{ base_cost_gb }}">
            </div>
            <div class="form-group">
                <label>Price per Day (Toman)</label>
                <input type="number" id="conf-cost-day" class="form-input" value="{{ base_cost_day }}">
            </div>
            <button class="btn btn-primary" onclick="saveConfig()" style="width: 100%; margin-top: 10px;">Save Tariffs</button>
        </div>
    </div>

    <div class="server-card">
        <div class="server-header">
            <div class="server-title">
                <h3>ğŸ“¦ Ready Packages</h3>
            </div>
            <div class="server-actions">
                <button class="btn btn-success btn-sm" onclick="document.getElementById('pkg-modal').classList.remove('hidden')">+ Add Package</button>
            </div>
        </div>
        <div style="padding: 20px;">
            <div id="packages-list" class="servers-grid" style="grid-template-columns: 1fr; gap: 10px;">
                </div>
        </div>
    </div>
</div>

<div class="modal-overlay hidden" id="pkg-modal">
    <div class="modal modal-sm">
        <div class="modal-header">
            <h2>Add New Package</h2>
            <button class="modal-close" onclick="document.getElementById('pkg-modal').classList.add('hidden')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group"><label>Package Name</label><input type="text" id="pkg-name" class="form-input" placeholder="e.g., 1 Month 30GB"></div>
            <div class="form-group"><label>Duration (Days)</label><input type="number" id="pkg-days" class="form-input" placeholder="30"></div>
            <div class="form-group"><label>Volume (GB)</label><input type="number" id="pkg-vol" class="form-input" placeholder="30"></div>
            <div class="form-group"><label>Price (Toman)</label><input type="number" id="pkg-price" class="form-input" placeholder="100000"></div>
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="document.getElementById('pkg-modal').classList.add('hidden')">Cancel</button>
                <button class="btn btn-primary" onclick="createPackage()">Create</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', loadPackages);

    async function loadPackages() {
        try {
            const res = await fetch('/api/packages');
            const data = await res.json();
            const container = document.getElementById('packages-list');
            
            if (data.length === 0) {
                container.innerHTML = '<p class="text-muted text-center">No packages defined.</p>';
                return;
            }

            container.innerHTML = data.map(p => `
                <div style="display: flex; justify-content: space-between; align-items: center; background: var(--bg-dark); padding: 15px; border-radius: 10px; border: 1px solid var(--border-color);">
                    <div>
                        <strong style="font-size: 1.1rem; color: var(--text-primary);">${p.name}</strong>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 5px;">
                            â³ ${p.days} Days | ğŸ’¾ ${p.volume} GB
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="color: #4ade80; font-weight: bold;">${p.price.toLocaleString()} T</div>
                    </div>
                </div>
            `).join('');
        } catch (e) { console.error(e); }
    }

    async function createPackage() {
        const data = {
            name: document.getElementById('pkg-name').value,
            days: document.getElementById('pkg-days').value,
            volume: document.getElementById('pkg-vol').value,
            price: document.getElementById('pkg-price').value
        };
        
        try {
            const res = await fetch('/admin/packages', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            
            if (res.ok) {
                showToast('Package created successfully');
                document.getElementById('pkg-modal').classList.add('hidden');
                loadPackages();
            } else {
                showToast('Error creating package', 'error');
            }
        } catch (e) { showToast('Connection error', 'error'); }
    }

    async function saveConfig() {
        const data = {
            cost_per_gb: document.getElementById('conf-cost-gb').value,
            cost_per_day: document.getElementById('conf-cost-day').value
        };
        try {
            await fetch('/admin/config', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            showToast('Configuration saved');
        } catch (e) { showToast('Error saving config', 'error'); }
    }
</script>
{% endblock %}
````

**2. Create `templates/transactions.html`:**
This page displays the financial history.

Paste this code into `templates/transactions.html`:

```html
{% extends "base.html" %}
{% block title %}Transactions{% endblock %}
{% block page_title %}Financial Report{% endblock %}

{% block content %}
<div class="server-card">
    <div class="server-header">
        <div class="server-title">
            <h3>Transaction History</h3>
        </div>
    </div>
    <div style="overflow-x: auto;">
        <table class="clients-table" style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr>
                    <th style="padding: 15px; text-align: left;">Date</th>
                    <th style="padding: 15px; text-align: left;">Type</th>
                    <th style="padding: 15px; text-align: left;">Amount</th>
                    <th style="padding: 15px; text-align: left;">Description</th>
                </tr>
            </thead>
            <tbody id="trans-list">
                <tr><td colspan="4" style="text-align: center; padding: 20px;">Loading...</td></tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const res = await fetch('/api/transactions');
            const data = await res.json();
            const tbody = document.getElementById('trans-list');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="padding: 20px; text-align: center; color: var(--text-secondary);">No transactions found.</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(t => {
                const isPositive = t.amount > 0;
                const color = isPositive ? '#4ade80' : '#ef4444';
                const sign = isPositive ? '+' : '';
                const date = new Date(t.date).toLocaleString();
                
                let typeBadgeClass = 'badge';
                if (t.type === 'deposit') typeBadgeClass += ' active';
                else if (t.type === 'purchase') typeBadgeClass += ' inactive';
                
                return `
                    <tr style="border-bottom: 1px solid var(--border-color);">
                        <td style="padding: 15px; color: var(--text-primary);">${date}</td>
                        <td style="padding: 15px;">
                            <span class="${typeBadgeClass}" style="text-transform: uppercase; font-size: 0.7rem;">${t.type}</span>
                        </td>
                        <td style="padding: 15px; color: ${color}; font-weight: bold; direction: ltr;">
                            ${sign}${t.amount.toLocaleString()} T
                        </td>
                        <td style="padding: 15px; color: var(--text-secondary);">${t.description || '-'}</td>
                    </tr>
                `;
            }).join('');
        } catch (e) {
            console.error(e);
            document.getElementById('trans-list').innerHTML = '<tr><td colspan="4" style="text-align: center; color: #ef4444;">Error loading data</td></tr>';
        }
    });
</script>
{% endblock %}
```

**3. Update `app.py` to render these pages:**
Add these routes to the end of your `app.py` (before `if __name__ == ...`):

```python
@app.route('/packages')
@superadmin_required
def packages_page():
    # Fetch config to pre-fill the form
    cost_gb = SystemConfig.query.get('cost_per_gb')
    cost_day = SystemConfig.query.get('cost_per_day')
    
    return render_template('packages.html', 
                         base_cost_gb=int(cost_gb.value) if cost_gb else 0,
                         base_cost_day=int(cost_day.value) if cost_day else 0)

@app.route('/transactions')
@login_required
def transactions_page():
    return render_template('transactions.html')
```

**4. Important: Update the `dashboard` route in `app.py`:**
The dashboard needs the base costs for the custom plan calculator to work. Update the existing `@app.route('/')` function:

```python
@app.route('/')
@login_required
def dashboard():
    user = Admin.query.get(session['admin_id'])
    
    # ... existing server filtering logic ...
    # (Keep your existing server filtering logic here)
    if user.role == 'reseller':
        allowed_ids = json.loads(user.allowed_servers) if user.allowed_servers and user.allowed_servers != '*' else []
        if user.allowed_servers == '*':
            servers = Server.query.filter_by(enabled=True).all()
        else:
            servers = Server.query.filter(Server.id.in_(allowed_ids), Server.enabled == True).all()
    else:
        servers = Server.query.filter_by(enabled=True).all()

    # Fetch configs
    cost_gb = SystemConfig.query.get('cost_per_gb')
    cost_day = SystemConfig.query.get('cost_per_day')

    return render_template('dashboard.html', 
                         servers=servers, 
                         server_count=len(servers),
                         admin_username=user.username,
                         is_superadmin=(user.role == 'superadmin' or user.is_superadmin),
                         role=user.role,
                         credit=user.credit,
                         # Pass these new variables:
                         base_cost_gb=int(cost_gb.value) if cost_gb else 0,
                         base_cost_day=int(cost_day.value) if cost_day else 0)
```

```

---

Ø¨Ø¹Ø¯ Ø§Ø² Ø§ÛŒÙ†Ú©Ù‡ Ø§ÛŒÙ† ÙØ§Ø² Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ØŒ ÙÙ‚Ø· ÛŒÚ© Ù…Ø±Ø­Ù„Ù‡ (ÙØ§Ø² Ûµ) Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ Ú©Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Ù…Ù†Ùˆ Ùˆ ØµÙØ­Ù‡ Users Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ ØªØ§ Ø³ÛŒØ³ØªÙ… Û±Û°Û°Ùª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ø´ÙˆØ¯. Ù‡Ø± Ø²Ù…Ø§Ù† Ø¢Ù…Ø§Ø¯Ù‡ Ø¨ÙˆØ¯ÛŒØ¯ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯.
```
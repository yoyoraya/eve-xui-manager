Ø¨Ø³ÛŒØ§Ø± Ø¹Ø§Ù„ÛŒ. Ø¯Ø± Ø§ÛŒÙ† Ú¯Ø§Ù… (Ú¯Ø§Ù… Ø³ÙˆÙ…)ØŒ Ù…Ø§ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ (UI) Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ØªØ§ Ø¨ØªÙˆØ§Ù†ÛŒØ¯: Û±. Ø¯Ø± ØµÙØ­Ù‡ AdminsØŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø±Ø§ Ø¨Ø§ Ù†Ù‚Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù (SuperAdmin, Admin, Reseller) Ø¨Ø³Ø§Ø²ÛŒØ¯ Ùˆ Ø¨Ù‡ Ø±ÛŒØ³Ù„Ø±Ù‡Ø§ Ø§Ø¹ØªØ¨Ø§Ø± (Credit) Ø¨Ø¯Ù‡ÛŒØ¯. Û². Ø¯Ø± ØµÙØ­Ù‡ DashboardØŒ Ú©Ù„Ø§ÛŒÙ†Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ ÛŒÚ© Ø±ÛŒØ³Ù„Ø± Ù…ØªØµÙ„ (Assign) Ú©Ù†ÛŒØ¯.

Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø§ Ú©Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯.

Û±. ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ§ÛŒÙ„ templates/admins.html
Ø§ÛŒÙ† ÙØ§ÛŒÙ„ ØªØºÛŒÛŒØ± Ø§Ø³Ø§Ø³ÛŒ Ú©Ø±Ø¯Ù‡ ØªØ§ Ø¨ØªÙˆØ§Ù†ÛŒØ¯ Ù†Ù‚Ø´ (Role)ØŒ Ø§Ø¹ØªØ¨Ø§Ø± Ùˆ Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ Ù…Ø¬Ø§Ø² Ø±Ø§ ØªØ¹ÛŒÛŒÙ† Ú©Ù†ÛŒØ¯.

HTML

{% extends "base.html" %}

{% block title %}Admins - Eve Manager{% endblock %}
{% block page_title %}User Management{% endblock %}

{% block header_actions %}
<button class="btn btn-primary" onclick="openAddAdminModal()">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
    </svg>
    Add User
</button>
{% endblock %}

{% block content %}
<div class="admins-section">
    <div class="admins-grid" id="admins-container">
    </div>
</div>

<div class="modal-overlay hidden" id="admin-modal">
    <div class="modal">
        <div class="modal-header">
            <h2 id="modal-title">Add User</h2>
            <button class="modal-close" onclick="closeAdminModal()">&times;</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="edit-admin-id">
            
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="admin-username" placeholder="Username">
            </div>
            
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="admin-password" placeholder="Leave empty to keep current">
            </div>

            <div class="form-group">
                <label>Role</label>
                <select id="admin-role" class="form-select" onchange="toggleResellerFields()">
                    <option value="reseller">Reseller</option>
                    <option value="admin">Admin</option>
                    <option value="superadmin">Super Admin</option>
                </select>
            </div>

            <div id="reseller-fields">
                <div class="form-group">
                    <label>Credit (Amount/Count)</label>
                    <input type="number" id="admin-credit" placeholder="0" value="0">
                </div>
                
                <div class="form-group">
                    <label>Allowed Servers (IDs separated by comma or *)</label>
                    <input type="text" id="admin-allowed-servers" placeholder="e.g. 1, 2 or *" value="*">
                    <small style="color: var(--text-secondary); font-size: 0.7rem;">Use * for all servers</small>
                </div>
            </div>

            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="admin-enabled" checked>
                    <span>Enabled</span>
                </label>
            </div>
            
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeAdminModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveAdmin()">Save</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let admins = [];
    
    document.addEventListener('DOMContentLoaded', loadAdmins);
    
    function toggleResellerFields() {
        const role = document.getElementById('admin-role').value;
        const fields = document.getElementById('reseller-fields');
        if (role === 'reseller') {
            fields.style.display = 'block';
        } else {
            fields.style.display = 'none';
        }
    }

    async function loadAdmins() {
        try {
            const response = await fetch('/api/admins');
            admins = await response.json();
            renderAdmins();
        } catch (error) {
            showToast('Error loading admins', 'error');
        }
    }
    
    function formatJalaliDate(isoString) {
        if (!isoString) return 'Never';
        const date = new Date(isoString);
        return date.toLocaleDateString('fa-IR');
    }
    
    function renderAdmins() {
        const container = document.getElementById('admins-container');
        
        if (admins.length === 0) {
            container.innerHTML = '<p class="no-data">No users found</p>';
            return;
        }
        
        container.innerHTML = admins.map(admin => `
            <div class="admin-card ${!admin.enabled ? 'disabled' : ''}">
                <div class="admin-avatar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </div>
                <div class="admin-info">
                    <h3>${admin.username}</h3>
                    <div class="admin-badges">
                        <span class="badge ${admin.role}">${admin.role.toUpperCase()}</span>
                        ${admin.enabled ? '<span class="badge active">Enabled</span>' : '<span class="badge inactive">Disabled</span>'}
                    </div>
                    ${admin.role === 'reseller' ? `
                        <div style="margin-top: 8px; font-size: 0.8rem; color: #4ade80;">
                            ğŸ’° Credit: <strong>${admin.credit}</strong>
                        </div>
                    ` : ''}
                    <p class="admin-meta" style="margin-top: 5px;">
                        Last Login: ${formatJalaliDate(admin.last_login)}
                    </p>
                </div>
                <div class="admin-actions">
                    <button class="action-btn" onclick="editAdmin(${admin.id})" title="Edit">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                    </button>
                    <button class="action-btn danger" onclick="deleteAdmin(${admin.id})" title="Delete">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                    </button>
                </div>
            </div>
        `).join('');
    }
    
    function openAddAdminModal() {
        document.getElementById('modal-title').textContent = 'Add User';
        document.getElementById('edit-admin-id').value = '';
        document.getElementById('admin-username').value = '';
        document.getElementById('admin-password').value = '';
        document.getElementById('admin-role').value = 'reseller';
        document.getElementById('admin-credit').value = '0';
        document.getElementById('admin-allowed-servers').value = '*';
        document.getElementById('admin-enabled').checked = true;
        
        toggleResellerFields();
        document.getElementById('admin-modal').classList.remove('hidden');
    }
    
    function editAdmin(id) {
        const admin = admins.find(a => a.id === id);
        if (!admin) return;
        
        document.getElementById('modal-title').textContent = 'Edit User';
        document.getElementById('edit-admin-id').value = admin.id;
        document.getElementById('admin-username').value = admin.username;
        document.getElementById('admin-password').value = '';
        document.getElementById('admin-role').value = admin.role || 'admin';
        document.getElementById('admin-credit').value = admin.credit || 0;
        
        let servers = admin.allowed_servers;
        if (Array.isArray(servers)) {
            servers = servers.length > 0 ? servers.join(', ') : '*';
        }
        document.getElementById('admin-allowed-servers').value = servers || '*';
        
        document.getElementById('admin-enabled').checked = admin.enabled;
        
        toggleResellerFields();
        document.getElementById('admin-modal').classList.remove('hidden');
    }
    
    function closeAdminModal() {
        document.getElementById('admin-modal').classList.add('hidden');
    }
    
    async function saveAdmin() {
        const id = document.getElementById('edit-admin-id').value;
        const role = document.getElementById('admin-role').value;
        
        // Parse Allowed Servers
        let allowedServersRaw = document.getElementById('admin-allowed-servers').value.trim();
        let allowedServers = [];
        if (allowedServersRaw === '*') {
            allowedServers = '*'; // Special flag for all
        } else {
            allowedServers = allowedServersRaw.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
        }

        const data = {
            username: document.getElementById('admin-username').value,
            password: document.getElementById('admin-password').value,
            role: role,
            credit: parseInt(document.getElementById('admin-credit').value) || 0,
            allowed_servers: allowedServers, // Send as array or '*'
            enabled: document.getElementById('admin-enabled').checked
        };
        
        if (!data.username) {
            showToast('Username is required', 'error');
            return;
        }
        
        try {
            const url = id ? `/api/admins/${id}` : '/api/admins';
            const method = id ? 'PUT' : 'POST';
            
            const response = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            if (result.success) {
                showToast(id ? 'User updated' : 'User added');
                closeAdminModal();
                loadAdmins();
            } else {
                showToast(result.error || 'Error saving', 'error');
            }
        } catch (error) {
            showToast('Error saving', 'error');
        }
    }
    
    async function deleteAdmin(id) {
        if (!confirm('Are you sure you want to delete this user?')) return;
        try {
            const response = await fetch(`/api/admins/${id}`, { method: 'DELETE' });
            if (response.ok) {
                showToast('User deleted');
                loadAdmins();
            }
        } catch (error) { showToast('Error deleting', 'error'); }
    }
</script>
{% endblock %}
Û². ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ§ÛŒÙ„ templates/dashboard.html
Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¢Ù¾Ø¯ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯ ØªØ§:

Ø¯Ú©Ù…Ù‡ Ø¬Ø¯ÛŒØ¯ Assign Owner ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø³ÙˆÙ¾Ø±Ø§Ø¯Ù…ÛŒÙ† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.

Ù…ÙˆØ¯Ø§Ù„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÛŒØ³Ù„Ø± Ùˆ Ø§ØªØµØ§Ù„ Ú©Ù„Ø§ÛŒÙ†Øª Ø§Ø¶Ø§ÙÙ‡ Ø´ÙˆØ¯.

Ù…ÙˆØ¬ÙˆØ¯ÛŒ (Credit) Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ³Ù„Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.

HTML

{% extends "base.html" %}

{% block title %}Dashboard - X-UI{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block header_actions %}
<div class="header-controls">
    {% if role == 'reseller' %}
    <div class="credit-badge" style="background: rgba(34, 197, 94, 0.2); color: #4ade80; padding: 8px 15px; border-radius: 12px; font-weight: bold; border: 1px solid rgba(34, 197, 94, 0.3);">
        ğŸ’° Credit: {{ credit }}
    </div>
    {% endif %}

    <label class="toggle-switch" title="Auto Refresh">
        <input type="checkbox" id="auto-refresh-toggle" onchange="toggleAutoRefresh()">
        <span class="slider"></span>
    </label>
    <select id="refresh-interval" class="interval-select" onchange="updateRefreshInterval()">
        <option value="10">10s</option>
        <option value="30">30s</option>
        <option value="60" selected>60s</option>
    </select>
    <button class="btn btn-primary" onclick="refreshData()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
        Refresh
    </button>
    <button class="btn btn-success" onclick="openAddClientModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"></path></svg>
        Add Client
    </button>
</div>
{% endblock %}

{% block content %}
<div class="stats-grid">
    <div class="stat-card"><div class="stat-icon purple"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect></svg></div><div class="stat-info"><span class="stat-label">Servers</span><span class="stat-value" id="stat-servers">{{ server_count }}</span></div></div>
    <div class="stat-card"><div class="stat-icon blue"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg></div><div class="stat-info"><span class="stat-label">Inbounds</span><span class="stat-value" id="stat-inbounds">0</span><span class="stat-sub" id="stat-active">0 Active</span></div></div>
    <div class="stat-card"><div class="stat-icon green"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></div><div class="stat-info"><span class="stat-label">Clients</span><span class="stat-value" id="stat-total-clients">0</span><div class="client-breakdown"><span class="client-count active-count"><span id="stat-active-clients">0</span></span><span class="client-count inactive-count"><span id="stat-inactive-clients">0</span></span></div></div></div>
    <div class="stat-card"><div class="stat-icon orange"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg></div><div class="stat-info"><span class="stat-label">Total Traffic</span><span class="stat-value" id="stat-traffic">0 B</span><span class="stat-sub"><span id="stat-upload">â†‘ 0 B</span> / <span id="stat-download">â†“ 0 B</span></span></div></div>
</div>

<div class="inbounds-section">
    <div class="section-header">
        <h2>Inbounds</h2>
        <span class="badge" id="inbounds-count">0 total</span>
    </div>
    <div style="margin-bottom: 20px;">
        <div style="display: flex; gap: 10px; align-items: center;">
            <input type="text" id="global-search-input" placeholder="Search clients..." class="form-input" style="flex: 1; padding: 10px 12px;">
            <button class="btn btn-secondary" onclick="clearSearch()" id="clear-search-btn" style="display: none;">Clear</button>
        </div>
        <div id="search-results" style="display: none; margin-top: 10px; padding: 10px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; font-size: 14px;">
            <span id="search-results-text"></span>
        </div>
    </div>
    
    <div class="inbounds-list" id="inbounds-container">
        </div>
</div>

<div class="modal-overlay hidden" id="assign-modal">
    <div class="modal modal-sm">
        <div class="modal-header">
            <h2>Assign to Reseller</h2>
            <button class="modal-close" onclick="closeAssignModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p style="color: var(--text-secondary); margin-bottom: 15px;">Client: <strong id="assign-client-email" style="color: var(--text-primary);"></strong></p>
            <input type="hidden" id="assign-server-id">
            <input type="hidden" id="assign-client-email-hidden">
            
            <div class="form-group">
                <label>Select Reseller</label>
                <select id="assign-reseller-select" class="form-select">
                    <option value="">Loading...</option>
                </select>
            </div>
            
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeAssignModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitAssignment()">Assign</button>
            </div>
        </div>
    </div>
</div>

{% include 'templates/dashboard_modals_partial.html' ignore missing %} 
{% endblock %}

{% block scripts %}
<script>
    // Ø§Ù†ØªÙ‚Ø§Ù„ Ù…ØªØºÛŒØ± Ø³ÙˆÙ¾Ø±Ø§Ø¯Ù…ÛŒÙ† Ø¨Ù‡ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ø±Ø§ÛŒ Ø´Ø±Ø·ÛŒ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
    const IS_SUPERADMIN = {{ 'true' if is_superadmin else 'false' }};
    const USER_ROLE = "{{ role }}";
    
    // ... (ØªÙ…Ø§Ù… Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ú¯Ù„ÙˆØ¨Ø§Ù„ Ù‚Ø¨Ù„ÛŒ Ù…Ø«Ù„ autoRefreshInterval Ùˆ...) ...
    let autoRefreshInterval = null;
    let inboundsData = [];
    let allServers = [];

    document.addEventListener('DOMContentLoaded', function() {
        // ... (Ú©Ø¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ) ...
        showLoading();
        refreshData(true).then(() => hideLoading());
        loadServers();
        document.getElementById('global-search-input').addEventListener('input', performGlobalSearch);
        
        // Ø§Ú¯Ø± Ø³ÙˆÙ¾Ø±Ø§Ø¯Ù…ÛŒÙ† Ø§Ø³ØªØŒ Ù„ÛŒØ³Øª Ø±ÛŒØ³Ù„Ø±Ù‡Ø§ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¯Ø§Ù„ Ø¨Ú¯ÛŒØ±
        if (IS_SUPERADMIN) loadResellersForModal();
    });

    // ... (ØªÙˆØ§Ø¨Ø¹ Ù‚Ø¨Ù„ÛŒ: toggleAutoRefresh, refreshData, updateStats, ...) ...

    // ØªØ§Ø¨Ø¹ Ù…Ù‡Ù…: Ø¢Ù¾Ø¯ÛŒØª Ø¬Ø¯ÙˆÙ„ Ú©Ù„Ø§ÛŒÙ†Øªâ€ŒÙ‡Ø§ (Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Assign)
    function updateInbounds(inbounds) {
        const container = document.getElementById('inbounds-container');
        document.getElementById('inbounds-count').textContent = `${inbounds.length} total`;
        
        if (inbounds.length === 0) {
            container.innerHTML = `<div class="empty-state"><h3>No data available</h3></div>`;
            return;
        }
        
        container.innerHTML = inbounds.map(inbound => `
            <div class="inbound-card ${!inbound.enable ? 'disabled' : ''}">
                <div class="inbound-header">
                    <div class="inbound-title">
                        <span class="protocol-badge ${inbound.protocol.toLowerCase()}">${inbound.protocol}</span>
                        <h3>${inbound.remark}</h3>
                        <span class="port-badge">:${inbound.port}</span>
                        <span class="server-badge">${inbound.server_name}</span>
                    </div>
                </div>
                
                ${inbound.clients.length > 0 ? `
                <div class="clients-section">
                    <button class="toggle-clients" onclick="toggleClients(this)">
                        Show Clients (${inbound.clients.length})
                    </button>
                    <div class="clients-list hidden">
                        <div class="clients-table-wrapper">
                            <table class="clients-table">
                                <thead>
                                    <tr>
                                        <th>Email</th>
                                        <th>Status</th>
                                        <th>Expiry</th>
                                        <th>Traffic</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${inbound.clients.map(client => `
                                    <tr class="${!client.enable ? 'disabled-row' : ''}">
                                        <td class="email-cell">${client.email}</td>
                                        <td>
                                            ${client.enable 
                                                ? `<span class="client-status active">Enabled</span>` 
                                                : `<span class="client-status inactive">Disabled</span>`}
                                        </td>
                                        <td><span class="expiry-badge ${client.expiryType}">${client.expiryTime}</span></td>
                                        <td class="traffic-cell">
                                            <span class="up">â†‘${client.up}</span> <span class="down">â†“${client.down}</span>
                                        </td>
                                        <td class="action-cell">
                                            <div class="action-buttons">
                                                <button class="action-btn" onclick="showQrCode('${encodeURIComponent(client.link)}', '${client.email}', '${client.sub_url}', '${client.json_url}', '${client.dash_sub_url}')">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                                                </button>
                                                <button class="action-btn renew" onclick="openRenewModal(${inbound.server_id}, ${inbound.id}, '${client.email}')">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
                                                </button>
                                                
                                                ${IS_SUPERADMIN ? `
                                                <button class="action-btn" onclick="openAssignModal(${inbound.server_id}, '${client.email}')" title="Assign to Reseller" style="color: #fbbf24;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>
                                                </button>
                                                ` : ''}
                                                
                                                <button class="action-btn ${client.enable ? 'danger' : 'success'}" onclick="toggleClient(${inbound.server_id}, ${inbound.id}, '${client.email}', ${!client.enable})">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><power></power></svg>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                ` : ''}
            </div>
        `).join('');
    }

    // --- ØªÙˆØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Assignment ---

    async function loadResellersForModal() {
        try {
            const response = await fetch('/api/admins');
            const admins = await response.json();
            const select = document.getElementById('assign-reseller-select');
            select.innerHTML = '<option value="">-- Select Reseller --</option>';
            
            admins.forEach(admin => {
                // ÙÙ‚Ø· Ø±ÛŒØ³Ù„Ø±Ù‡Ø§ Ø±Ø§ Ù†Ø´Ø§Ù† Ø¨Ø¯Ù‡
                if (admin.role === 'reseller') {
                    const option = document.createElement('option');
                    option.value = admin.id;
                    option.textContent = `${admin.username} (Credit: ${admin.credit})`;
                    select.appendChild(option);
                }
            });
        } catch (e) { console.error('Error loading resellers', e); }
    }

    function openAssignModal(serverId, email) {
        document.getElementById('assign-client-email').textContent = email;
        document.getElementById('assign-client-email-hidden').value = email;
        document.getElementById('assign-server-id').value = serverId;
        document.getElementById('assign-modal').classList.remove('hidden');
    }

    function closeAssignModal() {
        document.getElementById('assign-modal').classList.add('hidden');
    }

    async function submitAssignment() {
        const resellerId = document.getElementById('assign-reseller-select').value;
        const serverId = document.getElementById('assign-server-id').value;
        const email = document.getElementById('assign-client-email-hidden').value;

        if (!resellerId) {
            showToast('Please select a reseller', 'error');
            return;
        }

        try {
            const response = await fetch('/api/assign-client', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    server_id: serverId,
                    email: email,
                    reseller_id: resellerId
                })
            });
            const result = await response.json();
            if (result.success) {
                showToast('Client assigned successfully');
                closeAssignModal();
            } else {
                showToast(result.error, 'error');
            }
        } catch (e) {
            showToast('Error assigning client', 'error');
        }
    }

    // ... (Ø³Ø§ÛŒØ± ØªÙˆØ§Ø¨Ø¹ Ù‚Ø¨Ù„ÛŒ: toggleClients, showQrCode, copyText, ...) ...
    
    // (Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ ØªÙˆØ§Ø¨Ø¹ Ù…ÙˆØ¯Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ù‡Ù… Ø§ÛŒÙ†Ø¬Ø§ Ù‡Ø³ØªÙ†Ø¯)
</script>
{% endblock %}
âœ… Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ
Û±. Ø­Ø§Ù„Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø± Ù…Ù†ÙˆÛŒ AdminsØŒ ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Reseller Ø¨Ø³Ø§Ø²ÛŒØ¯ Ùˆ Ø¨Ù‡ Ø§Ùˆ Ø§Ø¹ØªØ¨Ø§Ø± Ø¯Ù‡ÛŒØ¯. Û². Ø³Ù¾Ø³ Ø¯Ø± Dashboard (Ø¨Ø§ Ø§Ú©Ø§Ù†Øª SuperAdmin)ØŒ Ú©Ù†Ø§Ø± Ù‡Ø± Ú©Ù„Ø§ÛŒÙ†Øª ÛŒÚ© Ø¯Ú©Ù…Ù‡ Ø²Ø±Ø¯ Ø±Ù†Ú¯ (Ø¢ÛŒÚ©ÙˆÙ† Ø¢Ø¯Ù…Ú© Ùˆ Ù…Ø«Ø¨Øª) Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒØ¯. Û³. Ø±ÙˆÛŒ Ø¢Ù† Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ Ùˆ Ú©Ù„Ø§ÛŒÙ†Øª Ø±Ø§ Ø¨Ù‡ Ø±ÛŒØ³Ù„Ø±ÛŒ Ú©Ù‡ Ø³Ø§Ø®ØªÛŒØ¯ ÙˆØµÙ„ Ú©Ù†ÛŒØ¯. Û´. Ø­Ø§Ù„Ø§ Ø§Ú¯Ø± Ø¨Ø§ Ø§Ú©Ø§Ù†Øª Ø±ÛŒØ³Ù„Ø± Ù„Ø§Ú¯ÛŒÙ† Ú©Ù†ÛŒØ¯ØŒ ÙÙ‚Ø· Ù‡Ù…Ø§Ù† Ú©Ù„Ø§ÛŒÙ†Øª Ø±Ø§ Ø®ÙˆØ§Ù‡Ø¯ Ø¯ÛŒØ¯! ğŸ‰